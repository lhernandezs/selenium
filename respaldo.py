from selenium import webdriver 
from selenium.webdriver.chrome.service import Service 
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By 
from selenium.webdriver.common.keys import Keys 

import os.path
import time
import json

# Configuración de las opciones de Chrome
options = Options()
appState = {
    "recentDestinations": [
        {
            "id"        : "Save as PDF",
            "origin"    : "local",
            "account"   : ""
        }
    ],
    "selectedDestination": "Save as PDF",
    "version": 2
}
prefs = {
    'printing.print_preview_sticky_settings.appState'   : json.dumps(appState),
    'savefile.default_directory'                        : 'C:\pdfs'
}

options.add_experimental_option('prefs', prefs)
options.add_argument('--kiosk-printing')
options.add_argument('start-maximized')

# Iniciar el driver
driver = webdriver.Chrome(options=options)

# Abrir la URL
#url = "https://sena.territorio.la/indexLoginDashboard.php"
url = "https://sena.territorio.la/indexJossoDashboard.php?login=true"
driver.get(url)

time.sleep(2)

# Loggearse con el usuario autorizado

usuario     = driver.find_element(By.XPATH, '//*[@id="document"]')
password    = driver.find_element(By.XPATH, '//*[@id="passwd"]')
                                  
# usuario     = driver.find_element(By.XPATH, '//*[@id="MyUserName"]')
# password    = driver.find_element(By.XPATH, '//*[@id="MyPassWord"]')
# usuario.send_keys('jpulgarin@sena.edu.co')
# password.send_keys('Jcamilo.210657')
usuario.send_keys('1098700739')
password.send_keys('231217Mypoke1098700739$')
# clicaBoton  = driver.find_element(By.XPATH, '//*[@id="LogIn"]')

clicaBoton  = driver.find_element(By.XPATH, '//*[@id="ingresar"]')
clicaBoton.click()

time.sleep(2)

# ficha vigentes -------------------------------------------------------------
#fichas = ['2674886','2694747','2837519','2864590','2820307','2758744','2721605','2721604','2758519','2834704','2834721','2721644','2758524','2721803','2834461','2834463',]
#fichas = ['2834461','2834463','2834720','2721645','2675877','2834356','2834703','2834734',
# fichas = ['2834735','2724978','2675878','2758523','2721646','2834460','2724979','2721602','2721804','2758425',]
# fichas = ['2721859','2721641','2758518','2721643','2864589','2721829','2834355','2675885','2721640','2834462','2721603','2834705',
# fichas = ['2879754','2675884','2721828',
#           '2721642', '2721647','2834736','2721860','2675717','2879546','2627062','2879699','2626900','2879837','2675831','2626898','2627066','2675826','2879572',
#           '2834851','2758230','2627072','2626937','2627073','2758190','2627206','2626957','2626901','2675830','2879694','2675911','2879844','2879835','2675759',
#           '2834854','2834852','2627070',]
# fichas = ['2879696','2455261','2626938','2675827','2834849','2879689','2834649','2879847','2675825','2675744','2834845','2758333','2834844','2626942','2627068','2834847',]
# fichas = ['2879691','2879610','2834850',
# fichas = ['2675820','2675832','2834853','2627204','2626958','2879841','2626944','2879838','2675758','2675791','2834838','2675747','2879839',]
# fichas = ['2626955','2675816','2879692','2879849','2834841','2627201',
# fichas = ['2627061','2879609','2879698','2675822','2879846','2675746','2879695','2626902','2626896','2675817',]
# fichas = ['2834840','2627202','2626941','2879836','2834839','2627063','2675818','2834856','2879690','2626940','2879843','2626899','2627071','2675828','2675824','2675823',]
# fichas = ['2675819','2627064','2834846','2627065','2834650','2834855','2879842','2455262','2675829','2879848','2834843','2626939','2879840','2675745','2626895','2626956',]
# fichas = ['2627205','2626943','2879697','2627203','2675815','2627069','2627060','2627067','2879845','2879693','2675912','2834848','2675821','2834842','2834651',]
# fichas = ['2626943','2879697','2627203','2675815','2627069','2627060','2627067','2879845','2879693','2675912','2834848','2675821','2834842','2834651',]
# fichas = ['2758524', '2834734', '2834850']
# fichas = ['2627069']

# 98 fichas productiva -------------------------------------------------------------
# fichas = ['1565036','1703943','1667869','1668063','1792941','2024568','1966041','2053108','1966040','1966038','1966039','1966036','1966005','1966004','1966037','2010654',
#           '1966035','1966024','1966025','2010669','2226697','2193547','2202979','2245174','2181422','2163300','2175906','2104681','2104841','2175908','2175898','2104842',
#           '2175909','2175895','2175904','2175893','2104760','2175900','2175905','2175899','2175897','2175894','2175896','2175902','2104843','2175907','2175903','2104680',]

# fichas = ['2104761','2175901','2282606','2404977','2348824','2282605','2404975','2281891','2282616','2348812','2282600','2374920','2282607','2374924','2374922','2282623',
#           '2282615','2282601','2282621','2282620','2374936','2282617','2374448','2282618','2348808','2374932','2282603','2374928','2374930','2374918','2404976','2348816',
#           '2282610','2282602','2374926','2374934','2282614','2282611','2282609','2282608','2374916','2282604','2348820','2282612','2282613','2348804','2348800','2282619',
#           '2282622','2348140',]

# 227 fichas  de productiva
# fichas = [  '2325833','2392508','2424547','2360130','2331283','2348811','2374948','2282661','2374944','2282672','2348821','2282635','2282564','2281631','2282555','2374917',
#             '2282633','2374929','2282531','2348285','2282525','2348815','2348333','2282589','2348646','2282643','2282552','2374951','2451822','2282597','2348700','2282651',
#             '2282642','2374925','2282592','2282662','2282569','2282549','2282666','2282665','2374634','2282558','2348827','2282676','2282628','2282540','2282522','2374943',
#             '2282632','2404847','2282649','2282591','2281655','2348825','2282598','2348803','2282590','2281706','2281979','2282654','2282627','2348733','2282577','2348809',
#             '2282640','2348805','2374942','2282580','2374949','2282663','2348682','2282568','2374946','2282576','2282561','2282668','2282573','2282593','2282534','2374952',
#             '2348807','2282637','2282587','2374947','2282588','2282650','2374953','2374941','2282582','2282648','2282570','2282674','2348813','2282658','2282537','2282670',
#             '2282645','2281782','2282543','2282567','2348819','2282634','2282644','2282677','2455262','2282646','2282599','2374954','2282641','2374950','2348817','2348397',
#             '2348217','2281628','2282675','2282639','2348369','2282638','2282575','2348823','2282664','2282660','2374933','2455261','2348718','2374892','2348736','2282523',]

# fichas = [  '2282657','2282565','2282631','2282636','2282655','2374672','2282566','2282630','2374927','2282647','2282667','2348801','2374931','2348697','2281582','2282585',
#             '2282671','2282659','2282595','2282562','2282586','2282594','2374945','2282584','2282572','2282546','2282524','2374940','2282653','2374885','2282656','2374583',
#             '2348664','2374871','2282625','2282629','2374955','2374921','2374938','2282581','2282528','2374935','2282521','2281749','2282563','2282579','2348661','2282578',
#             '2282527','2282574','2282673','2282526','2282652','2282583','2282571','2374939','2374937','2282596','2374878','2374923','2374919','2282669','2627152','2675885',
#             '2675877','2627140','2627151','2675884','2675878','2674886','2694747','2758744','2721803','2721645','2721828','2721640','2721829','2724978','2758425','2721859',
#             '2721644','2758524','2758519','2721605','2721604','2721641','2721860','2721647','2721642','2758518','2721643','2721602','2721603','2721804','2724979',  '2721646',
#             '2758523','2693998','2820307',]

#Silvia
fichas = ['2834857', '2834858','2834464','2834765','2828449','2879937','2879891']

while len(fichas) > 0:  

    ficha = fichas.pop(0)

    # Desplegar la ficha
    cajaFicha   = driver.find_element(By.XPATH, '//*[@id="nombreMateria"]')
    cajaFicha.send_keys(ficha)
    botonBuscar = driver.find_element(By.XPATH, '//*[@id="nombreMateriabuscar"]')
    botonBuscar.click()

    time.sleep(3)

    try:
        botonMostrarFicha = driver.find_element(By.XPATH, '//*[@id="catalogo-main-content"]/li/div/div[2]/span[1]/div/a')
    except:
        cajaFicha.clear()
        print("No se encontró  la ficha", ficha)
        continue

    botonMostrarFicha.click()
    nombreArchivo= (driver.find_element(By.XPATH,'//*[@id="groupTitle tt"]').text).replace("\n", " ")

    # Desplegar los botones "Ver mas"
    ban = True
    contador = 50   
    while ban and contador > 0 :
        try:
            time.sleep(3)
            driver.execute_script('javascript:verMas()')
        except: 
            ban = False
        contador -= 1

    # Guadar la pagina como un archivo html
    with open(os.path.join('',ficha + '.html'), "a", encoding="utf-8") as f:
        f.write(driver.page_source)

    # Ejecutar el script de impresión pdf
    #driver.execute_script('window.print();')
    print('ficha ', nombreArchivo)

    # Volver a la pagina inicial 
    driver.get('https://sena.territorio.la/init.php')
    time.sleep(4)

# Cerrar el driver
driver.quit()

print("-----FIN-----")